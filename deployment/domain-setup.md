# Domain and SSL Setup Guide - ClearLane Initiative

## Domain Configuration

### 1. Domain Purchase and Setup
```bash
# Recommended domain providers:
# - Namecheap (recommended for nonprofits)
# - Cloudflare Registrar (best performance)
# - Google Domains (easy integration)

Domain: clearlane.org
Alternatives: clearlanenyc.org, clearlane.net
```

### 2. DNS Configuration
```dns
# A Records
@ 76.76.19.19 (Vercel IP)
www 76.76.19.19 (Vercel IP)

# CNAME Records
www.clearlane.org -> clearlane.org
dashboard.clearlane.org -> clearlane.org
api.clearlane.org -> clearlane.org

# TXT Records (Verification)
@ "v=spf1 include:_spf.google.com ~all"
@ "google-site-verification=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
@ "facebook-domain-verification=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"

# MX Records (Email)
@ 1 smtp.google.com.
@ 5 smtp2.google.com.
@ 5 smtp3.google.com.
@ 10 smtp4.google.com.

# DMARC and DKIM
_dmarc.clearlane.org "v=DMARC1; p=quarantine; rua=mailto:dmarc@clearlane.org"
default._domainkey.clearlane.org [DKIM key from email provider]
```

### 3. Vercel Domain Setup
```bash
# Install Vercel CLI
npm i -g vercel

# Login and add domain
vercel login
vercel domains add clearlane.org
vercel domains add www.clearlane.org

# Configure project
vercel --prod
vercel alias set clearlane-initiative-website.vercel.app clearlane.org
vercel alias set clearlane-initiative-website.vercel.app www.clearlane.org
```

### 4. SSL Certificate Setup
```javascript
// vercel.json SSL configuration
{
  "functions": {
    "src/pages/api/**/*.ts": {
      "runtime": "nodejs18.x"
    }
  },
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "Strict-Transport-Security",
          "value": "max-age=31536000; includeSubDomains; preload"
        },
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        }
      ]
    }
  ]
}
```

## Security Configuration

### 1. Security Headers
```nginx
# Content Security Policy
Content-Security-Policy: default-src 'self';
  script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src 'self' https://fonts.gstatic.com;
  img-src 'self' data: https:;
  connect-src 'self' https://www.google-analytics.com;

# Additional Security Headers
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: camera=(), microphone=(), geolocation=()
```

### 2. HTTPS Redirect Configuration
```javascript
// middleware.ts
import { NextResponse } from 'next/server';

export function middleware(request) {
  // Force HTTPS
  if (request.headers.get('x-forwarded-proto') !== 'https') {
    return NextResponse.redirect(
      `https://${request.headers.get('host')}${request.nextUrl.pathname}`,
      301
    );
  }

  // WWW redirect
  if (request.headers.get('host') === 'www.clearlane.org') {
    return NextResponse.redirect(
      `https://clearlane.org${request.nextUrl.pathname}`,
      301
    );
  }
}
```

## Performance Optimization

### 1. CDN Configuration
```javascript
// Edge locations prioritization
{
  "regions": ["iad1", "sfo1", "lhr1"], // East Coast, West Coast, Europe
  "functions": {
    "src/pages/api/**/*.ts": {
      "runtime": "nodejs18.x",
      "regions": ["iad1", "sfo1"]
    }
  }
}
```

### 2. Caching Strategy
```javascript
// Cache headers
{
  "headers": [
    {
      "source": "/images/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/_astro/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    },
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=3600, s-maxage=86400"
        }
      ]
    }
  ]
}
```

## Email Configuration

### 1. Google Workspace Setup
```yaml
# Domain: clearlane.org
# Users:
- contact@clearlane.org (main contact)
- press@clearlane.org (media inquiries)
- policy@clearlane.org (stakeholder communications)
- data@clearlane.org (research inquiries)
- admin@clearlane.org (technical/admin)

# Aliases:
- info@clearlane.org -> contact@clearlane.org
- hello@clearlane.org -> contact@clearlane.org
- support@clearlane.org -> contact@clearlane.org
```

### 2. Email Security
```dns
# SPF Record
v=spf1 include:_spf.google.com ~all

# DKIM (generated by Google Workspace)
google._domainkey IN TXT "v=DKIM1; k=rsa; p=[PUBLIC_KEY]"

# DMARC Policy
v=DMARC1; p=quarantine; rua=mailto:dmarc-reports@clearlane.org; ruf=mailto:dmarc-failures@clearlane.org; fo=1
```

## Subdomain Configuration

### 1. Application Subdomains
```dns
# Production
api.clearlane.org -> clearlane.org (API routes)
dashboard.clearlane.org -> clearlane.org/dashboard
data.clearlane.org -> clearlane.org/data-explorer

# Development/Staging
dev.clearlane.org -> clearlane-dev.vercel.app
staging.clearlane.org -> clearlane-staging.vercel.app
```

### 2. Media and Assets
```dns
# CDN for large assets
media.clearlane.org -> [CDN_ENDPOINT]
images.clearlane.org -> [CDN_ENDPOINT]/images
docs.clearlane.org -> [CDN_ENDPOINT]/documents
```

## Monitoring and Alerts

### 1. Domain Monitoring
```yaml
# SSL Certificate monitoring
- Certificate expiry alerts (90 days before)
- HTTPS connectivity monitoring
- DNS propagation monitoring

# Tools:
- Vercel built-in monitoring
- UptimeRobot for external monitoring
- SSL Labs for security grading
```

### 2. Performance Monitoring
```javascript
// Real User Monitoring
{
  "speedInsights": {
    "enabled": true
  },
  "webAnalytics": {
    "enabled": true
  }
}
```

## Backup and Recovery

### 1. DNS Backup
```bash
# Export current DNS settings
dig clearlane.org ANY > dns-backup.txt
dig www.clearlane.org ANY >> dns-backup.txt

# Backup configuration
cp vercel.json vercel.json.backup
cp astro.config.mjs astro.config.mjs.backup
```

### 2. Rollback Strategy
```bash
# Quick rollback commands
vercel rollback [DEPLOYMENT_URL]
vercel alias set [PREVIOUS_DEPLOYMENT] clearlane.org

# Emergency DNS changes
# Keep backup DNS provider configured
# Secondary domain ready: clearlanenyc.org
```

## Launch Checklist

### Pre-launch
- [ ] Domain purchased and configured
- [ ] SSL certificate active and valid
- [ ] DNS propagation complete (24-48 hours)
- [ ] Email addresses configured and tested
- [ ] Security headers implemented and tested
- [ ] Performance benchmarks recorded

### Launch Day
- [ ] Final DNS changes applied
- [ ] All redirects tested
- [ ] SSL Labs security grade A+
- [ ] Google Search Console verified
- [ ] Social media verification completed
- [ ] Email deliverability tested

### Post-launch
- [ ] Monitor uptime and performance
- [ ] Check SSL certificate renewal (auto)
- [ ] Verify search engine indexing
- [ ] Social media integration working
- [ ] Contact forms delivering emails