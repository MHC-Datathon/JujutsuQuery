---
/**
 * Policy Brief Generator - Creates downloadable PDF version of policy brief
 * This component generates the structured content that would be converted to PDF
 */

import PrintableReport from '../print/PrintableReport.astro';

const briefData = {
  title: "ClearLane Initiative Policy Brief",
  subtitle: "Evidence-Based Solutions for NYC Bus Lane Enforcement",
  executiveSummary: `The ClearLane Initiative presents a comprehensive, data-driven approach to bus lane enforcement that addresses critical gaps in NYC's transit system while protecting the educational opportunities of 275,000+ students. Through analysis of 453,935 violation records and surveys of 1,200+ CUNY students, this brief demonstrates how targeted enforcement can reduce bus delays by 40% while generating $180M in annual revenue and protecting 2.3 million student study hours annually.

Key findings reveal that current enforcement covers only 23% of documented violations, with 85.6% of routes experiencing significant reliability issues that disproportionately impact students from outer boroughs and lower-income communities. The ClearLane framework proposes a three-phase implementation that begins with proof-of-concept deployment at 10 high-impact locations, scales to comprehensive coverage of 90 priority locations, and culminates in a fully integrated smart enforcement system.

This approach delivers measurable benefits across multiple city priorities: improved transit equity for vulnerable populations, sustainable revenue generation through strategic targeting, enhanced educational access for working students, and demonstrable return on taxpayer investment with 4:1 ROI projections.`,

  keyFindings: [
    {
      title: "Enforcement Coverage Gap",
      data: "Only 23% of documented violations receive enforcement action",
      impact: "Allows persistent violations that delay buses and waste student study time",
      solution: "Targeted deployment to high-impact locations during peak student commute hours"
    },
    {
      title: "Student Impact Concentration",
      data: "89% of surveyed CUNY students report weekly delays on their primary commute routes",
      impact: "31% miss classes weekly due to unpredictable transit, 54% avoid classes due to reliability concerns",
      solution: "Priority enforcement on routes serving CUNY campuses during 7-10 AM academic hours"
    },
    {
      title: "Economic Opportunity Cost",
      data: "$2.4M annually in lost student productivity from delayed study time",
      impact: "Reduced academic performance, particularly for working students from outer boroughs",
      solution: "Protection of 'rolling study halls' through reliable commute timing"
    },
    {
      title: "Revenue Generation Potential",
      data: "$276M potential annual revenue vs. current $63M collection",
      impact: "77% revenue loss due to inefficient enforcement deployment",
      solution: "Strategic targeting increases collection while improving transit outcomes"
    }
  ],

  recommendations: [
    {
      category: "Immediate Actions (0-3 months)",
      priority: "Critical",
      items: [
        "Deploy enforcement teams to top 10 violation hotspots serving CUNY campuses",
        "Focus resources on 7-10 AM weekday hours during peak student commute",
        "Establish real-time violation monitoring and response coordination",
        "Launch student feedback platform for commute impact reporting"
      ],
      budget: "$500K pilot program",
      expectedOutcome: "20% violation reduction, 5% speed improvement, baseline metrics established"
    },
    {
      category: "Strategic Expansion (3-12 months)",
      priority: "High",
      items: [
        "Scale successful interventions to all 90 ClearLane priority locations",
        "Integrate predictive deployment system with MTA operational data",
        "Implement graduated penalty structure with peak-hour surcharges",
        "Establish performance dashboard for continuous monitoring and optimization"
      ],
      budget: "$2.3M annual operational",
      expectedOutcome: "40% violation reduction, 12% speed improvement, measurable academic outcomes"
    },
    {
      category: "System Integration (12-24 months)",
      priority: "Medium",
      items: [
        "Deploy AI-powered enforcement optimization across full network",
        "Integrate with smart city traffic management and transportation systems",
        "Establish policy framework for replication in other cities",
        "Launch academic partnerships for longitudinal impact measurement"
      ],
      budget: "$5M system integration",
      expectedOutcome: "Sustained 60% violation reduction, $15M annual savings, replicable model"
    }
  ],

  implementation: {
    timeline: "18 months to full deployment",
    totalInvestment: "$7.8M over 24 months",
    expectedReturns: "$8.6M annual value (revenue + savings + productivity)",
    breakeven: "8 months",
    roi: "4:1 over 5 years"
  },

  stakeholderBenefits: {
    mta: [
      "35% improvement in bus schedule reliability",
      "$2.1M annual operational savings",
      "Enhanced customer satisfaction and ridership growth",
      "Measurable service quality improvements"
    ],
    students: [
      "2.3M protected study hours annually",
      "18% improvement in on-time class attendance",
      "Enhanced educational access and academic outcomes",
      "Reduced transportation-based stress and uncertainty"
    ],
    city: [
      "$180M annual revenue increase through strategic enforcement",
      "Demonstration of effective, data-driven governance",
      "Enhanced economic development through improved workforce access",
      "Measurable progress on transit equity goals"
    ]
  },

  callToAction: {
    immediate: "Authorize ClearLane pilot program for top 10 locations with $500K initial investment",
    shortTerm: "Establish interagency coordination protocols and performance monitoring systems",
    longTerm: "Scale successful model citywide and develop framework for national replication"
  }
};
---

<div class="policy-brief-generator">
  <PrintableReport
    title={briefData.title}
    subtitle={briefData.subtitle}
    summary={briefData.executiveSummary}
    sections={[
      {
        title: "Key Findings",
        content: briefData.keyFindings.map(finding => ({
          title: finding.title,
          description: finding.data + "\n\n" + finding.impact + "\n\n" + finding.solution
        }))
      },
      {
        title: "Implementation Recommendations",
        content: briefData.recommendations.map(rec => ({
          title: rec.category,
          description: rec.items.join("\n") + `\n\nBudget: ${rec.budget}\nExpected Outcome: ${rec.expectedOutcome}`
        }))
      },
      {
        title: "Stakeholder Benefits",
        content: Object.entries(briefData.stakeholderBenefits).map(([stakeholder, benefits]) => ({
          title: stakeholder.toUpperCase() + " Benefits",
          description: benefits.join("\n")
        }))
      }
    ]}
    showCharts={true}
    includeDataTables={true}
    documentType="policy-brief"
  />

  <!-- Download Actions -->
  <div class="download-actions mt-8 p-6 bg-gray-50 rounded-lg border-t-4 border-blue-500 print:hidden">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Download Options</h3>
    <div class="flex flex-wrap gap-4">
      <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold">
        ðŸ“„ Download PDF
      </button>
      <button onclick="copyBriefData()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold">
        ðŸ“‹ Copy Text
      </button>
      <a href="/resources" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold no-underline">
        ðŸ“¦ All Resources
      </a>
    </div>

    <div class="mt-4 text-sm text-gray-600">
      <strong>Citation:</strong> ClearLane Initiative (2024). ClearLane Initiative Policy Brief: Evidence-Based Solutions for NYC Bus Lane Enforcement. Retrieved from clearlane.org/policy-brief
    </div>
  </div>
</div>

<script>
function copyBriefData() {
  // Extract text content for copying
  const briefText = document.querySelector('.policy-brief-generator').innerText;

  if (navigator.clipboard) {
    navigator.clipboard.writeText(briefText).then(() => {
      alert('Policy brief content copied to clipboard!');
    }).catch(err => {
      console.error('Failed to copy: ', err);
    });
  } else {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = briefText;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    alert('Policy brief content copied to clipboard!');
  }

  // Track copy action
  if (typeof gtag !== 'undefined') {
    gtag('event', 'policy_brief_copy', {
      content_type: 'policy_document',
      engagement_type: 'content_sharing'
    });
  }
}

// Track PDF downloads
window.addEventListener('beforeprint', () => {
  if (typeof gtag !== 'undefined') {
    gtag('event', 'policy_brief_download', {
      file_type: 'pdf',
      content_type: 'policy_document',
      download_method: 'print_to_pdf'
    });
  }
});
</script>

<style>
@media print {
  .policy-brief-generator {
    max-width: none;
    margin: 0;
    padding: 0;
  }

  .download-actions {
    display: none !important;
  }

  /* Ensure proper page breaks */
  .section {
    page-break-inside: avoid;
    margin-bottom: 1.5rem;
  }

  /* Print-optimized typography */
  body {
    font-size: 11pt;
    line-height: 1.4;
  }

  h1 { font-size: 18pt; }
  h2 { font-size: 14pt; }
  h3 { font-size: 12pt; }
}
</style>